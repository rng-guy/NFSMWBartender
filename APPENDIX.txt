
── ■ │ WHAT IS IN THIS APPENDIX? (v1.13.01) │ ■ ───────────────────────────────────────────────────

This document is also on GitHub: https://github.com/rng-guy/NFSMWBartender/blob/master/APPENDIX.md

This document contains the full TECHNICAL DETAILS AND LIMITATIONS of Bartender and its features.
In most cases, the usage comments in Bartender's configuration files should provide you with
enough background information to help you avoid most (potential) configuration issues.

This document also mentions any INCOMPATIBLE FEATURES of other .asi mods where they are relevant.
For an overview of what you need to disable for Bartender to work, see the main README instead.

You ONLY NEED TO READ THIS DOCUMENT if you either
 • have persistent issues with your game after installing Bartender, or
 • are curious about the limitations and inner workings of Bartender (or the game itself).

There are mostly THREE POTENTIAL CAUSES for any issues you might encounter with Bartender:
 • features of other .asi mods that make changes to the same parts of the game as Bartender,
 • quirks in how Bartender reads and processes parameter values in its configuration files, and
 • the actual parameter values themselves that you provide in Bartender's configuration files.

To HELP YOU TROUBLESHOOT ISSUES with Bartender, the sections below address these questions:
 1) • What is there to know about Bartender's file parsing?
 2) • What is there to know about the "Basic" feature set?
 3) • What is there to know about the "Advanced" feature set?
 4) • What changed in each version of Bartender?






── ■ 1 - WHAT IS THERE TO KNOW ABOUT BARTENDER'S FILE PARSING? ■ ──────────────────────────────────

Some PARAMETER GROUPS (indicated by "[GroupName]") in Bartender's configuration files allow
you to define a "default" value. For each parameter group, a comment in the relevant file states
whether the group allows this. Bartender parses groups that allow "default" values in three steps:
 1) • If you omitted it, the "default" value is set to the game's vanilla (i.e. unmodded) value.
 2) • All free-roam Heat levels (format: "heatXY") you omitted are set to the "default" value.
 3) • All race Heat levels (format: "raceXY") you omitted are set to their free-roam values.

Bartender can handle any INVALID / MISSING PARAMETER GROUPS in its configuration files:
 • duplicate (e.g. another "[Busting:General]") and unknown groups are ignored, and
 • missing groups make Bartender count each of their would-be values as omitted.

Bartender can handle any INVALID VALUES you might provide in its configuration files:
 • duplicates (e.g. another "heat02" value) within parameter groups are ignored,
 • values of incorrect type (e.g. a string instead of a decimal) count as omitted,
 • negative values that should be positive are set to 0 instead of counting as omitted,
 • mismatched interval values (i.e. where "max" < "min") are each set to the lower value, and
 • comma-separated value pairs / tuples with too many or too few (valid) values count as omitted.

Bartender can handle any INVALID VEHICLES you might provide in its configuration files.
The sections below mention how on a case-by-case basis, but a vehicle is generally invalid if
 • it doesn't exist in the game's database (i.e. lacks a VltEd node under "pvehicle"), or
 • it is of the wrong class (e.g. is a helicopter when Bartender expects a regular car).

The CLASS OF A VEHICLE depends on the "CLASS" VltEd parameter in its "pvehicle" node. Bartender
considers a "CLASS" value of "CHOPPER" to represent a helicopter, and every other value a car.
Most vanilla vehicles lack an explicit "CLASS" parameter in their "pvehicle" nodes because they
inherit one from parent nodes instead, but you can add one manually to overwrite it if you wish.






── ■ 2 - WHAT IS THERE TO KNOW ABOUT THE "BASIC" FEATURE SET? ■ ───────────────────────────────────

Regarding the "BASIC" feature set IN GENERAL:

 • The configuration (.ini) files for this feature set are located in "BartenderSettings\Basic".

 • The unedited configuration files for this feature set use the game's vanilla values.

 • You can disable this entire feature set by deleting all of its configuration files.

 • You can disable any feature of this set by deleting the file containing its parameters.
   Bug fixes, however, don't have parameters and are tied to specific files implicitly instead.

 • To disable the shadow and Heat-level fixes, delete all configuration files of this feature set.

 • The Heat-level reset fix is incompatible with the "HeatLevelOverride" feature of the 
   "NFSMW ExtraOptions" mod by ExOptsTeam. To disable this ExtraOptions feature, edit its
   "NFSMWExtraOptionsSettings.ini" configuration file. If you do this, you can still change 
   the maximum available Heat level with VltEd: The "0xe8c24416" parameter of a given
   "race_bin_XY" VltEd node determines the maximum Heat level (1-10) at Blacklist rival #XY.

 • If you don't install the optional missing textures ("FixMissingTextures.end"), then the
   game won't display a number next to Heat gauges in menus for cars with Heat levels > 5.
   Whether you install these textures does not affect the Heat-level reset fix in any way.



Regarding COP (BINARY) STRINGS ("BartenderSettings\Basic\Labels.ini"):

 • This feature is incompatible with the "EnableCopDestroyedStringHook" feature of the 
   "NFSMW Unlimiter" mod by nlgxzef. Either delete Bartender's "Labels.ini" configuration file
   or disable Unlimiter's version of the feature by editing its "NFSMWUnlimiterSettings.ini" file.

 • Bartender ignores all vehicles and (Binary) string labels that don't actually exist in the game.

 • If you do not define a valid "default" value, vehicles you omit will not cause notifications.



Regarding GROUND SUPPORTS ("BartenderSettings\Basic\Supports.ini"):

 • Deleting this file also disables the fix for slower roadblock and Heavy / LeaderStrategy spawns.

 • Very short cooldowns for regular roadblocks or Heavy / LeaderStrategy spawns can result in spam.

 • The "MinimumSupportDelay" VltEd parameter defines how much time needs to pass before
   regular roadblocks and Heavy / LeaderStrategy spawns can first appear in a given pursuit.

 • LeaderStrategy 5 spawns Cross by himself, while LeaderStrategy 7 spawns him with two henchmen.

 • You should not use the replacement vehicles for Cross elsewhere in the game. Otherwise, these
   vehicles will block all LeaderStrategy spawns whenever they are present in a given pursuit.

 • Only the original "copcross" vehicle triggers Cross' unique radio chatter and callouts.

 • Bartender replaces all vehicles that don't exist in the game with their vanilla counterparts.

 • Bartender replaces all vehicles that are helicopters with their vanilla counterparts.



Regarding UNCATEGORISED FEATURES ("BartenderSettings\Basic\Others.ini"):

 • Deleting this file also disables the fix for getting busted while the green "EVADE" bar fills.

 • The "BUSTED" bar fills when you drive slowly enough and are near a cop who can see you.
   Once the bar is full, the cops apprehend you and end the pursuit (not in your favour).

 • The "BustSpeed" VltEd parameter defines the speed threshold for busting.
   
 • The "EVADE" bar fills when you are not within line of sight of any cops. Once the bar is full,
   you enter "COOLDOWN" mode and need to stay hidden for a while to escape (and end) the pursuit.

 • The "evadetimeout" VltEd parameter defines how long you need to stay hidden in "COOLDOWN" mode.

 • The time you spend filling the green "EVADE" bar also counts towards how long you need to stay
   hidden in "COOLDOWN" mode. If the "EVADE" bar takes longer to fill, you will escape instantly.

 • The "frontLOSdistance" and "rearLOSdistance" VltEd parameters define the cops' visual range.

 • The "0x1e2a1051" VltEd parameter defines how much passive bounty you gain at each interval.

 • The "DestroyCopBonusTime" VltEd parameter defines the time window for cop combos.

 • Bartender sets all cop-combo limits that are < 1 to 1.






── ■ 3 - WHAT IS THERE TO KNOW ABOUT THE "ADVANCED" FEATURE SET? ■ ────────────────────────────────

Regarding the "Advanced" feature set IN GENERAL:

 • The configuration (.ini) files for this feature set are located in "BartenderSettings\Advanced".

 • The unedited configuration files for this feature set use the game's vanilla values.

 • You can disable this entire feature set by deleting all of its configuration files.

 • You can disable any feature of this set by deleting the file containing its parameters. This
   does not apply to the engagement-count fix, which is tied to this entire feature set instead.

 • You must provide at least one vehicle in the "Chasers" spawn table of each free-roam Heat level
   ("BartenderSettings\Advanced\Cars.ini"), else Bartender disables this entire feature set.

 • You should ensure that every HeavyStrategy you enable in a given Heat level's "pursuitsupport"
   VltEd node is only listed there once (e.g. there isn't a second HeavyStrategy 3), and that
   there is also no more than one LeaderStrategy listed. Otherwise, such duplicates can cause
   the game (and Bartender) to misread their "Duration" VltEd parameters.

 • If this feature set is enabled, the following "pursuitlevels" VltEd parameters are ignored
   because this feature set fulfils their intended purposes with extended customisation:
   "cops", "HeliFuelTime", "TimeBetweenHeliActive", and "SearchModeHeliSpawnChance".


   
Regarding HELICOPTER (DE / RE)SPAWNING ("BartenderSettings\Advanced\Helicopter.ini"):

 • The helicopter only spawns at Heat levels for which you provide valid time-interval values.

 • The helicopter will also spawn in "COOLDOWN" mode by default.

 • The helicopter uses whatever HeliStrategy you set in VltEd.

 • Only one helicopter will ever be active at any given time. This is a game limitation;
   you could technically spawn more, but they would count as cars and behave very oddly.

 • Bartender replaces all vehicles that don't exist in the game with "copheli".

 • Bartender replaces all vehicles that aren't helicopters with "copheli".



Regarding COP (DE / RE)SPAWNING ("BartenderSettings\Advanced\Cars.ini"):

 • A minimum engagement count > 0 allows that many "Chasers" to (re)spawn without backup. This
   minimum count does not spawn cops beyond their "count" values or the global cop-spawn limit.

 • In "COOLDOWN" mode, the "NumPatrolCars" VltEd parameter overwrites the min. engagement count.

 • The global cop-spawn limit determines whether the game may spawn new "Chasers" at any point.
   The game can spawn additional "Chasers" as long as the total amount of non-roadblock and
   non-helicopter cops that currently exist across all pursuits is less than this global limit.
   This also means that any active Heavy / LeaderStrategy spawns or NPC pursuits can affect 
   how many more "Chasers" can still spawn in your pursuit (this is vanilla behaviour).

 • The global cop-spawn limit takes precedence over all other spawning-related parameters, except
   for the "NumPatrolCars" VltEd parameter outside of active pursuits (this is vanilla behaviour).

 • If you want to use global cop spawn limits > 8, you must also install and configure the
   "NFSMW LimitAdjuster" mod (LA) by Zolika1351. This is necessary because the game cannot
   handle managing > 8 "Chasers" for very long. To configure LA to work with Bartender,
   open LA's "NFSMWLimitAdjuster.ini" configuration file and disable everything in its 
   "[Options]" parameter group. Even with this, LA itself might still crash sometimes.

 • "Chasers" will only flee at Heat levels for which you provide valid delay values.

 • Bartender sets all "count" and "chance" values that are < 1 to 1.
   
 • The "chance" values are weights (like in VltEd), not percentages. The actual spawn chance of
   a vehicle is its "chance" value divided by the sum of the "chance" values of all vehicles from
   the same spawn table. Whenever a vehicle reaches its "count" value (i.e. spawn cap), Bartender
   treats its "chance" value as 0 until there is room for further spawns of that vehicle again.

 • Bartender uses the free-roam "Chasers" spawn tables (which must contain at least one vehicle) 
   in place of all free-roam "Roadblocks", "Events", and "Patrols" spawn tables you leave empty.

 • Bartender uses the free-roam spawn tables in place of all race spawn tables you leave empty.

 • Bartender ignores all vehicles that don't exist in the game.

 • Bartender ignores all vehicles that are helicopters.

 • Bartender adds a "copmidsize" to each non-empty table that contains only ignored vehicles.

 • Vehicles in "Roadblocks" spawn tables are not equally likely to spawn in every vehicle position 
   of a given roadblock formation. This is because the game processes roadblock spawns in a fixed,
   formation-dependent order, making it (e.g.) more likely for vehicles with low "count" and high
   "chance" values to spawn in any position that happens to be processed first. This does not apply
   to vehicles with "count" values of at least 5, as no roadblock consists of more than 5 cars.

 • Rarely, vehicles that are not in a "Roadblocks" spawn table will still show up in roadblocks.
   This is a vanilla bug: it usually happens when the game attempts to spawn a vehicle while it is
   processing a roadblock request, causing it to place the wrong car in the requested roadblock.
   Even more rarely than that, this bug can also happen with traffic cars or the helicopter.

 • Once they join a pursuit, "Events" and "Patrol" spawns also count as "Chasers" as far as
   membership (i.e. fleeing decisions) and the "count" values of "Chasers" are concerned.

 • The "Events" spawn tables also apply to the scripted patrols in prologue (DDay) race events.

 • The "Events" spawn tables don't apply to the very first scripted, pre-generated cop that
   spawns in a given free-roam event (e.g. a Challenge Series pursuit). Instead, this first cop
   is always of the type defined by the event's "CopSpawnType" VltEd parameter. This is because
   the game requests this vehicle before it loads any pursuit or Heat-level information, making
   it impossible for Bartender to know which spawn table to use for this single vehicle.

 • Bartender temporarily ignores the "count" values in a "Roadblocks" / "Events" spawn table
   whenever a roadblock / event requests more vehicles in total than they would otherwise allow.
   You can avoid this by ensuring that the totals of all "count" values amount to at least 5 / 8
   for each "Roadblocks" / "Events" spawn table, as no roadblock / event in the vanilla game
   consists of more than 5 / 8 vehicles in total.

 • You should not use fast Heat transitions ("0x80deb840" VltEd parameter(s) set to < 5 seconds),
   else you might see a mix of cops from more than one "Events" spawn table appear in events with
   scripted, pre-generated cops. This happens because, depending on your loading times, the game
   might update the Heat level as it requests those spawns. You can avoid this issue by setting
   the event's "ForceHeatLevel" VltEd parameter to the target Heat level instead.

 • Bartender uses different spawn tables for each of the two patrol-spawn types in the game:
   "Patrols" tables replace the free patrols that spawn when there is no active pursuit,
   and "Chasers" tables replace the searching patrols that spawn in pursuits when you are
   in "COOLDOWN" mode. You can control the number of patrol spawns through the "NumPatrolCars"
   VltEd parameter, but there are two important quirks: Free patrol spawns ignore the global
   cop-spawn limit, while searching patrol spawns ignore the remaining engagement count.

   




── ■ │ 4 - WHAT CHANGED IN EACH VERSION OF BARTENDER? │ ■ ─────────────────────────────────────────

v1.00.00: Initial release
      01: Revised "LIMITATIONS" section of README
      02: Revised multiple sections of README
      03: Yet another minor README revision
      04: README? More like "FIXME"
      05: Clarified "Events" spawns in "Cars.ini"
      06: Clarified string assignment in "Labels.ini"
      07: Clarified ignored VltEd parameters when "Advanced" feature set is enabled
      08: Corrected a few typos in README
      09: Clarified cooldowns in "Supports.ini" and helicopter spawns in "Helicopter.ini"
      10: Revised multiple .ini comments and enforced consistency
      11: Further clarified cooldowns in "Supports.ini"
      12: Improved formatting of .ini files and expanded "LIMITATIONS" section of README
      13: Added compatibility note for VltEd and other .asi mods in "LIMITATIONS" section of README
      14: Added compatibility note for Binary mods in "LIMITATIONS" section of README
      15: Added note about README structure
      16: Clarified stability of "NFSMW LimitAdjuster" in "LIMITATIONS" section of README

   01.00: Fixed a bug with vehicle names containing underscores
      01: Removed some superfluous memory patches

   02.00: Improved thread safety of cop-spawn interceptor functions
      01: Rephrased spawning-related entries in "LIMITATIONS" section of README
      02: Removed redundant push / pop instructions

   03.00: Fixed the Heat-level update in free-roam and a rare bug of the game miscounting cops
      01: Rephrased "LIMITATIONS" section of README yet again

   04.00: Added post-race pursuit hook and changed cop count to decrement after full despawns only
      01: Added workaround for vanilla bug of fleeing HeavyStrategy 3 spawns ("ADVANCED" set only)
      02: Improved phrasing and corrected some typos in README

   05.00: Added "count" support to custom "Roadblocks" and "Events" spawn tables
      01: Rephrased README to better reflect recent changes to both feature sets
      02: Restructured "LIMITATIONS" section of README and renamed both "General.ini" files
      03: Restructured and rephrased README some more
      04: Merged "Behaviour.ini" with "Cars.ini" file
      05: Clarified global cop-spawn limit in "LIMITATIONS" section of README and "Cars.ini" file
      06: Added missing number-format comment to "Others.ini" file

   06.00: Fixed incorrect labelling of roadblock vehicles joining pursuits after spike-strip hits
      01: Made terminology in README and .ini files files more consistent, and rephrased some parts

   07.00: Fixed Heavy / LeaderStrategy spawns not fleeing as per their "Duration" VltEd parameters
      01: Improved general performance of cop management functions for the "ADVANCED" set
      02: Clarified some ambiguous phrasing in "LIMITATIONS" section of README
      03: Clarified the different types of patrol spawns in README and "Cars.ini" file
      04: Rephrased parts of the README for what feels like the millionth time

   08.00: Added support for separate free-roam and race pursuit parameters
      01: Improved performance slightly and expanded "LIMITATIONS" section of README

   09.00: Added fixes for Heat levels above 5 resetting and missing menu textures in Career mode
      01: It's a bird! It's a plane! No, it's yet another fresh batch of phrasing corrections!
      02: Added information about enabling / disabling individual bug fixes to README
      03: Clarified logic of spawn-table copying in "LIMITATIONS" section of README
      04: Corrected mislabelled spawn tables in "LIMITATIONS" section of README
      05: Rephrased a couple more parts of the README to remove ambiguity
      06: Overhauled entire README and renamed parameter group in "Labels.ini" file
      07: Improved clarity of README by replacing most references with nouns

   10.00: Assigned correct spawn table to first cop spawn in Career milestone / bounty pursuits
      01: Improved readability of README by overhauling language and phrasing throughout
      02: Expanded all comments and also rearranged busting parameters in configuration files
      03: Further expanded file parsing and usage notes subsections in README
      04: Edited configuration files of "Advanced" feature set to use the game's vanilla values

   11.00: Fixed "Events" spawn tables not applying to scripted patrol spawns in prologue races
      01: Added missing reset hook for "Events" spawn tables between consecutive (prologue) races
      02: Made phrasing of comments in configuration files more internally consistent
      03: Clarified comments about "NFSMW LimitAdjuster" in "Cars.ini" file and README
      04: Improved performance slightly by removing redundant assembly instructions

   12.00: Added fix for vanilla helicopter shadows and further improved performance
      01: Improved performance even more by removing redundant re-hashing
      02: Fixed rare edge case of "Events" spawns temporarily blocking "Chasers" spawns
      03: Another performance improvement by reducing re-hashing even further

   13.00: Improved performance by rewriting and streamlining the internal file-parsing logic
      01: Added checks for whether vehicles in configuration files exist and are of the right class