
── ■ │ WHAT IS THIS APPENDIX ABOUT? (v1.14.02) │ ■ ────────────────────────────────────────────────

This document is also on GitHub: https://github.com/rng-guy/NFSMWBartender/blob/master/APPENDIX.md

This document contains the full TECHNICAL DETAILS AND LIMITATIONS of Bartender and its features,
and it also mentions any incompatible features of other .asi mods wherever they are relevant.
For a quick overview of what you may need to disable for Bartender to work, see the README.

You really ONLY NEED TO READ THIS DOCUMENT if
 • you have persistent issues with your game after installing / configuring Bartender, or
 • you are curious about the technicalities and limitations of Bartender or its features.

First, if Bartender's .asi file gets FALSELY FLAGGED AS A VIRUS by your antivirus software,
you will need to whitelist the file. If the flagging happens as you attempt to launch your
game with Bartender installed, the .asi loader will display a pop-up window with an error
message ("Error code: 225") before your antivirus likely (re)moves the .asi file.

Last, there are three POSSIBLE CAUSES FOR IN-GAME ISSUES you might encounter with Bartender:
 • features of other .asi mods that make changes to the same parts of the game as Bartender,
 • the quirks of how Bartender reads and processes parameters in its configuration files, or
 • the actual parameter values themselves that you provide in Bartender's configuration files.

To help you SOLVE IN-GAME ISSUES with Bartender, the sections below address these questions:
 1) • What is there to know about Bartender's file parsing?
 2) • What is there to know about the "Basic" feature set?
 3) • What is there to know about the "Advanced" feature set?
 4) • What changed in each version of Bartender?






── ■ 1 - WHAT IS THERE TO KNOW ABOUT BARTENDER'S FILE PARSING? ■ ──────────────────────────────────

Bartender parses its configuration (.ini) files in PARAMETER GROUPS, indicated by "[GroupName]".
These groups each contain related parameters and give a logical structure in the configuration
files. Each group allows you to provide values, either in relation to Heat levels or vehicles.

Bartender can handle any INVALID / MISSING PARAMETER GROUPS in its configuration files:
 • duplicate (e.g. another "[Busting:General]") and unknown groups are ignored, and
 • missing groups make Bartender count each of their would-be values as omitted.

Bartender can handle any INVALID VALUES you might provide in its parameter groups:
 • duplicates (e.g. another "heat02" value) within parameter groups are ignored,
 • values of incorrect type (e.g. a string instead of a decimal) count as omitted,
 • negative values that should be positive are set to 0 instead of counting as omitted,
 • mismatched interval values (i.e. where "max" < "min") are each set to the lower value, and
 • comma-separated value pairs / tuples with too many or too few (valid) values count as omitted.

Some parameter groups allow you to define DEFAULT VALUES, indicated by "default" in place of
a Heat level or vehicle. These default values then apply to all Heat levels or vehicles for
which you don't provide explicit values. Bartender parses such parameter groups in three steps:
 1) • If you omit it, the "default" value is set to the game's vanilla (i.e. unmodded) value.
 2) • All free-roam Heat levels (format: "heatXY") you omit are set to the "default" value.
 3) • All race Heat levels (format: "raceXY") you omit are set to their free-roam values.

Bartender can handle any INVALID VEHICLES you might provide in its configuration files,
both as values themselves and as something for which you provide other values. The sections
below mention how Bartender does this on a case-by-case basis, but a vehicle is invalid if
 • it doesn't exist in the game's database (i.e. lacks a VltEd node under "pvehicle"), or
 • it's of the wrong class (e.g. is a helicopter when Bartender expects a regular car).

The CLASS OF A VEHICLE depends on the "CLASS" VltEd parameter in its "pvehicle" node. Bartender
considers a "CLASS" value of "CHOPPER" to represent a helicopter, and every other value a car.
Most vanilla vehicles lack an explicit "CLASS" parameter in their "pvehicle" nodes because they
inherit one from parent nodes instead, but you can add one manually to overwrite it if you wish.






── ■ 2 - WHAT IS THERE TO KNOW ABOUT THE "BASIC" FEATURE SET? ■ ───────────────────────────────────

Regarding the "BASIC" feature set IN GENERAL:

 • The configuration (.ini) files for this feature set are located in "BartenderSettings\Basic".

 • The unedited configuration files for this feature set use the game's vanilla values.

 • You can disable this entire feature set by deleting all of its configuration files.

 • You can disable any feature of this set by deleting the file containing its parameter group.
   Bug fixes, however, don't have parameters and are tied to specific files implicitly instead.

 • To disable the shadow and Heat-level fixes, delete all configuration files of this feature set.

 • The Heat-level reset fix is incompatible with the "HeatLevelOverride" feature of the 
   "NFSMW ExtraOptions" mod by ExOptsTeam. To disable this ExtraOptions feature, edit its
   "NFSMWExtraOptionsSettings.ini" configuration file. If you do this, you can still change 
   the maximum available Heat level with VltEd: The "0xe8c24416" parameter of a given
   "race_bin_XY" VltEd node determines the maximum Heat level (1-10) at Blacklist rival #XY.

 • If you don't install the optional missing textures ("FixMissingTextures.end"), then the
   game won't display a number next to Heat gauges in menus for cars with Heat levels > 5.
   Whether you install these textures does not affect the Heat-level reset fix in any way.



Regarding COP (BINARY) STRINGS ("BartenderSettings\Basic\Labels.ini"):

 • This feature is incompatible with the "EnableCopDestroyedStringHook" feature of the 
   "NFSMW Unlimiter" mod by nlgxzef. Either delete Bartender's "Labels.ini" configuration file
   or disable Unlimiter's version of the feature by editing its "NFSMWUnlimiterSettings.ini" file.

 • Bartender ignores vehicles and (Binary) string labels that don't exist in the game.

 • You can use the "Binary" tool by MaxHwoy to edit the game's strings or add new ones.

 • If you don't define a valid "default" label, vehicles without labels won't cause notifications.



Regarding GROUND SUPPORTS ("BartenderSettings\Basic\Supports.ini"):

 • Deleting this file disables the fix for slower roadblock and Heavy / LeaderStrategy requests.

 • When the game requests a non-Strategy roadblock, a random roadblock cooldown begins.
   While this cooldown is active, the game cannot make more non-Strategy roadblock requests.

 • When the game requests a Heavy / LeaderStrategy, a fixed-length strategy cooldown begins.
   While this cooldown is active, the game cannot make more Heavy / LeaderStrategy requests.

 • When the game requests a HeavyStrategy, it (re)sets the roadblock cooldown to a fixed value.
 
 • Bartender fixes the slowdown of non-Strategy roadblock and Heavy / LeaderStrategy requests
   by clearing the request queue. Bartender clears this queue whenever a certain amount of time
   has passed without any new requests, despite either being off cooldown. This maximum-overdue
   delay guarantees that requests cannot block each other for too long. The most common
   causes of such blockages tend to be long-overdue HeavyStrategy 3 requests.

 • Sometimes, non-Strategy roadblock or Heavy / LeaderStrategy spawns may appear more or less
   frequently than their cooldowns would suggest. This happens because these cooldowns only affect
   requests, not actual spawns: While every spawn is the result of a request, not every request
   results in a spawn. The game remains free to spawn or cancel any pending support request.

 • Very short cooldowns for non-Strategy roadblock or Heavy / LeaderStrategy requests may cause
   excessive spam. Such spam might lead to game instability, as Heavy / LeaderStrategy spawns
   ignore spawn limits. You can reduce this risk by using low(er) "Duration" VltEd parameters.

 • The "MinimumSupportDelay" VltEd parameter defines how much time needs to pass before the
   game can make non-Strategy roadblock and Heavy / LeaderStrategy requests in a given pursuit.

 • LeaderStrategy 5 spawns Cross by himself, while LeaderStrategy 7 spawns him with two henchmen.

 • You should not use the replacement vehicles for Cross elsewhere in the game. Otherwise, these
   vehicles will block all LeaderStrategy spawns whenever they are present in a given pursuit.

 • Only the original "copcross" vehicle triggers Cross' unique radio chatter and callouts.

 • Bartender replaces vehicles that don't exist in the game with whatever the vanilla game uses.

 • Bartender replaces vehicles that are helicopters with with whatever the vanilla game uses.



Regarding UNCATEGORISED FEATURES ("BartenderSettings\Basic\Others.ini"):

 • Deleting this file disables the fix for getting busted while the green "EVADE" bar fills.

 • The red "BUSTED" bar fills when you drive slowly enough and are near a cop who can see you.
   Once the bar is full, the cops apprehend you and end the pursuit in their favour.

 • The cops' visual range limits the effective max. bust distance. The cops' visual range is
   defined by the "frontLOSdistance", "rearLOSdistance", and "heliLOSdistance" VltEd parameters.

 • The "BustSpeed" VltEd parameter defines the speed threshold for busting.
   
 • The green "EVADE" bar fills when you are not within line of sight of any cops. Once the bar
   is full, you enter "COOLDOWN" mode and need to stay hidden for a while to escape the pursuit.

 • The "evadetimeout" VltEd parameter defines how long you need to stay hidden in "COOLDOWN" mode.

 • The time you spend filling the green "EVADE" bar also counts towards how long you need to stay
   hidden in "COOLDOWN" mode. If the "EVADE" bar takes longer to fill, you will escape instantly.

 • The "0x1e2a1051" VltEd parameter defines how much passive bounty you gain at each interval.

 • The "DestroyCopBonusTime" VltEd parameter defines the time window for cop combos.

 • Bartender sets all cop-combo limits that are < 1 to 1 instead.






── ■ 3 - WHAT IS THERE TO KNOW ABOUT THE "ADVANCED" FEATURE SET? ■ ────────────────────────────────

Regarding the "Advanced" feature set IN GENERAL:

 • The configuration (.ini) files for this feature set are located in "BartenderSettings\Advanced".

 • The unedited configuration files for this feature set use the game's vanilla values.

 • You can disable this entire feature set by deleting all of its configuration files.

 • You can disable any feature of this set by deleting the file containing its parameter group.
   This does not apply to the two bug fixes, which are each tied to this entire feature set.

 • Bartender disables this feature set if you leave any free-roam "Chasers" spawn table empty.

 • Rarely, the engagement count above the pursuit board may appear to be inaccurate compared
   to how many cops are actually around you at a given moment. That is because Bartender's fix 
   makes the engagement count track "Chasers" only, while disregarding any vehicles that join
   the pursuit through Heavy / LeaderStrategy spawns, from roadblocks, or as helicopters.

 • For each Heat level, you should use a "FullEngagementCopCount" VltEd parameter > 0.
   Otherwise, Bartender may fail to update the displayed engagement count accurately.

 • For each Heat level, you should (at most) only include each HeavyStrategy (3 and 4) once, 
   and only a single overall LeaderStrategy (5 or 7). Otherwise, any duplicates may cause
   the game (and Bartender) to misread their "Duration" VltEd parameters.

 • If this feature set is enabled, all HeavyStrategy 3 spawns will always attempt to ram
   you until their "Duration" VltEd parameters expire and they are forced to flee the pursuit.

 • If this feature set is enabled, the following "pursuitlevels" VltEd parameters are ignored
   because this feature set fulfils their intended purposes with extended customisation:
   "cops", "HeliFuelTime", "TimeBetweenHeliActive", and "SearchModeHeliSpawnChance".


   
Regarding HELICOPTER (DE / RE)SPAWNING ("BartenderSettings\Advanced\Helicopter.ini"):

 • The helicopter uses random timers for spawning, despawning, and respawning. Each of these
   actions has a separate interval of possible timer values. Here, "spawning" refers to the
   very first appearance of a helicopter in a given pursuit, while "respawning" refers to
   any further appearances after the first. Heat transitions don't reset these timers.

 • The helicopter only spawns at Heat levels for which you provide valid timer-interval values.

 • The helicopter also (de / re)spawns in "COOLDOWN" mode according to its timers.

 • The helicopter uses whatever HeliStrategy you set in VltEd.

 • Only one helicopter will ever be active at any given time. This is a game limitation;
   you could technically spawn more, but they would count as cars and behave very oddly.

 • Bartender replaces vehicles that don't exist in the game with "copheli".

 • Bartender replaces vehicles that aren't helicopters with "copheli".



Regarding COP (DE / RE)SPAWNING ("BartenderSettings\Advanced\Cars.ini"):

 • A minimum engagement count > 0 allows that many "Chasers" to (re)spawn without backup. This
   minimum count does not spawn cops beyond their "count" values or the global cop-spawn limit.

 • In "COOLDOWN" mode, the "NumPatrolCars" VltEd parameter overwrites the min. engagement count.

 • The global cop-spawn limit determines whether the game may spawn new "Chasers" at any point.
   The game can spawn additional "Chasers" as long as the total amount of non-roadblock and
   non-helicopter cops that currently exist across all pursuits is less than this global limit.
   This also means that any active Heavy / LeaderStrategy spawns or NPC pursuits can affect 
   how many more "Chasers" can still spawn in your pursuit (this is vanilla behaviour).

 • The global cop-spawn limit takes precedence over all other spawning-related parameters, except
   for the "NumPatrolCars" VltEd parameter outside of active pursuits (this is vanilla behaviour).

 • If you want to use global cop spawn limits > 8, you must also install and configure the
   "NFSMW LimitAdjuster" mod (LA) by Zolika1351. This is necessary because the game cannot
   handle managing > 8 "Chasers" for very long. To configure LA to work with Bartender,
   open LA's "NFSMWLimitAdjuster.ini" configuration file; there, set the "PursuitCops"
   value to 255 and disable every single cop-related feature under "[Options]". After 
   configuring LA like this, use only Bartender to set any global cop-spawn limits!

 • "Chasers" will only flee at Heat levels for which you provide valid delay values.
   
 • Bartender uses the free-roam "Chasers" spawn tables (which must contain at least one vehicle) 
   in place of all free-roam "Roadblocks", "Events", and "Patrols" spawn tables you leave empty.

 • Bartender uses the free-roam spawn tables in place of all race spawn tables you leave empty.

 • Bartender ignores vehicles that are helicopters or don't exist in the game.

 • Bartender adds a "copmidsize" to each non-empty table that contains only ignored vehicles.

 • The "chance" values are weights (like in VltEd), not percentages. The actual spawn chance of
   a vehicle is its "chance" value divided by the sum of the "chance" values of all vehicles from
   the same spawn table. Whenever a vehicle reaches its "count" value (i.e. spawn cap), Bartender
   treats its "chance" value as 0 until there is room for further spawns of that vehicle again.

 • Bartender sets all "count" and "chance" values that are < 1 to 1 instead.

 • Bartender enforces the "count" values for "Chasers" for each active pursuit separately.
   For "Roadblocks" / "Events", Bartender enforces "count" values for each roadblock / event.
   "Patrols" lack "count" values because they technically don't belong to anything trackable.

 • Once they join a pursuit, "Events" and "Patrols" spawns also count as "Chasers" as far
   as membership (i.e. fleeing decisions) and the "count" values of "Chasers" are concerned.

 • The "Roadblocks" spawn tables don't apply to HeavyStrategy 4 roadblocks.

 • Each roadblock / event in the game requests a hard-coded number of vehicles. No roadblock
   formation in the game requests more than 5 vehicles, and no scripted event more than 8.

 • Bartender temporarily ignores the "count" values in a "Roadblocks" / "Events" spawn table
   whenever a roadblock / event requests more vehicles in total than they would otherwise allow.
   This ensures the game cannot get stuck trying to spawn a roadblock or start a scripted event.

 • Vehicles in "Roadblocks" spawn tables are not equally likely to spawn in every vehicle position 
   of a given roadblock formation. This is because the game processes roadblock spawns in a fixed,
   formation-dependent order, making it (e.g.) more likely for vehicles with low "count" and high
   "chance" values to spawn in any position that happens to be processed first. This does not apply
   to vehicles with "count" values of at least 5, as no roadblock consists of more than 5 cars.

 • Rarely, vehicles that are not in a "Roadblocks" spawn table will still show up in roadblocks.
   This is a vanilla bug: it usually happens when the game attempts to spawn a vehicle while it's
   processing a roadblock request, causing it to place the wrong car in the requested roadblock.
   Even more rarely than that, this bug can also happen with traffic cars or the helicopter.

 • The "Events" spawn tables also apply to the scripted patrols in prologue (DDay) race events.

 • The "Events" spawn tables don't apply to the very first scripted, pre-generated cop that
   spawns in a given free-roam event (e.g. a Challenge Series pursuit). Instead, this first cop
   is always of the type defined by the event's "CopSpawnType" VltEd parameter. This is because
   the game requests this vehicle before it loads any pursuit or Heat-level information, making
   it impossible for Bartender to know which spawn table to use for just this single vehicle.

 • You should not use fast Heat transitions ("0x80deb840" VltEd parameter(s) set to < 5 seconds),
   else you might see a mix of cops from more than one "Events" spawn table appear in events with
   scripted, pre-generated cops. This happens because, depending on your loading times, the game
   might update the Heat level as it requests those spawns. You can avoid this issue by setting
   the event's "ForceHeatLevel" VltEd parameter to the target Heat level instead.

 • Bartender uses different spawn tables for each of the two patrol-spawn types in the game:
   "Patrols" tables replace the free patrols that spawn when there is no active pursuit,
   and "Chasers" tables replace the searching patrols that spawn in pursuits when you are
   in "COOLDOWN" mode. You can control the number of patrol spawns through the "NumPatrolCars"
   VltEd parameter, but there are two important quirks: Free patrol spawns ignore the global
   cop-spawn limit, while searching patrol spawns ignore the remaining engagement count.

   




── ■ │ 4 - WHAT CHANGED IN EACH VERSION OF BARTENDER? │ ■ ─────────────────────────────────────────

v1.00.00: Initial release
      01: Revised "LIMITATIONS" section of README
      02: Revised multiple sections of README
      03: Yet another minor README revision
      04: README? More like "FIXME"
      05: Clarified "Events" spawns in "Cars.ini"
      06: Clarified string assignment in "Labels.ini"
      07: Clarified ignored VltEd parameters when "Advanced" feature set is enabled
      08: Corrected a few typos in README
      09: Clarified cooldowns in "Supports.ini" and helicopter spawns in "Helicopter.ini"
      10: Revised multiple .ini comments and enforced consistency
      11: Further clarified cooldowns in "Supports.ini"
      12: Improved formatting of .ini files and expanded "LIMITATIONS" section of README
      13: Added compatibility note for VltEd and other .asi mods in "LIMITATIONS" section of README
      14: Added compatibility note for Binary mods in "LIMITATIONS" section of README
      15: Added note about README structure
      16: Clarified stability of "NFSMW LimitAdjuster" in "LIMITATIONS" section of README

   01.00: Fixed a bug with vehicle names containing underscores
      01: Removed some superfluous memory patches

   02.00: Improved thread safety of cop-spawn interceptor functions
      01: Rephrased spawning-related entries in "LIMITATIONS" section of README
      02: Removed redundant push / pop instructions

   03.00: Fixed the Heat-level update in free-roam and a rare bug of the game miscounting cops
      01: Rephrased "LIMITATIONS" section of README yet again

   04.00: Added post-race pursuit hook and changed cop count to decrement after full despawns only
      01: Added workaround for vanilla bug of fleeing HeavyStrategy 3 spawns ("ADVANCED" set only)
      02: Improved phrasing and corrected some typos in README

   05.00: Added "count" support to custom "Roadblocks" and "Events" spawn tables
      01: Rephrased README to better reflect recent changes to both feature sets
      02: Restructured "LIMITATIONS" section of README and renamed both "General.ini" files
      03: Restructured and rephrased README some more
      04: Merged "Behaviour.ini" with "Cars.ini" file
      05: Clarified global cop-spawn limit in "LIMITATIONS" section of README and "Cars.ini" file
      06: Added missing number-format comment to "Others.ini" file

   06.00: Fixed incorrect labelling of roadblock vehicles joining pursuits after spike-strip hits
      01: Made terminology in README and .ini files files more consistent, and rephrased some parts

   07.00: Fixed Heavy / LeaderStrategy spawns not fleeing as per their "Duration" VltEd parameters
      01: Improved general performance of cop management functions for the "ADVANCED" set
      02: Clarified some ambiguous phrasing in "LIMITATIONS" section of README
      03: Clarified the different types of patrol spawns in README and "Cars.ini" file
      04: Rephrased parts of the README for what feels like the millionth time

   08.00: Added support for separate free-roam and race pursuit parameters
      01: Improved performance slightly and expanded "LIMITATIONS" section of README

   09.00: Added fixes for Heat levels above 5 resetting and missing menu textures in Career mode
      01: It's a bird! It's a plane! No, it's yet another fresh batch of phrasing corrections!
      02: Added information about enabling / disabling individual bug fixes to README
      03: Clarified logic of spawn-table copying in "LIMITATIONS" section of README
      04: Corrected mislabelled spawn tables in "LIMITATIONS" section of README
      05: Rephrased a couple more parts of the README to remove ambiguity
      06: Overhauled entire README and renamed parameter group in "Labels.ini" file
      07: Improved clarity of README by replacing most references with nouns

   10.00: Assigned correct spawn table to first cop spawn in Career milestone / bounty pursuits
      01: Improved readability of README by overhauling language and phrasing throughout
      02: Expanded all comments and also rearranged busting parameters in configuration files
      03: Further expanded file parsing and usage notes subsections in README
      04: Edited configuration files of "Advanced" feature set to use the game's vanilla values

   11.00: Fixed "Events" spawn tables not applying to scripted patrol spawns in prologue races
      01: Added missing reset hook for "Events" spawn tables between consecutive (prologue) races
      02: Made phrasing of comments in configuration files more internally consistent
      03: Clarified comments about "NFSMW LimitAdjuster" in "Cars.ini" file and README
      04: Improved performance slightly by removing redundant assembly instructions

   12.00: Added fix for vanilla helicopter shadows and further improved performance
      01: Improved performance even more by removing redundant re-hashing
      02: Fixed rare edge case of "Events" spawns temporarily blocking "Chasers" spawns
      03: Another performance improvement by reducing re-hashing even further

   13.00: Improved performance by rewriting and streamlining the internal file-parsing logic
      01: Added checks for whether vehicles in configuration files exist and are of the right class
      02: Improved and overhauled the documentation for (hopefully) the last god-damn time
      03: Improved consistency of the fix for less frequent support spawns in longer pursuits

   14.00: Added fix for the vanilla bug of HeavyStrategy 3 spawns fleeing pursuits too early
      01: Improved performance some more thanks to my newfound disregard for antivirus evasion
      02: Fixed a few minor inconsistencies in README and some usage comments